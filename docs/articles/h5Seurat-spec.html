<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>h5Seurat File Format Specification • srtdisk</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="h5Seurat File Format Specification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">srtdisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/convert-anndata.html">Conversions: h5Seurat and AnnData</a></li>
    <li><a class="dropdown-item" href="../articles/h5Seurat-load.html">Saving and Loading Data from an h5Seurat File</a></li>
    <li><a class="dropdown-item" href="../articles/h5Seurat-spec.html">h5Seurat File Format Specification</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mianaz/srtdisk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>h5Seurat File Format Specification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mianaz/srtdisk/blob/HEAD/vignettes/h5Seurat-spec.Rmd" class="external-link"><code>vignettes/h5Seurat-spec.Rmd</code></a></small>
      <div class="d-none name"><code>h5Seurat-spec.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overall-file-structure">Overall File Structure<a class="anchor" aria-label="anchor" href="#overall-file-structure"></a>
</h2>
<div class="section level3">
<h3 id="required-attributes">Required Attributes<a class="anchor" aria-label="anchor" href="#required-attributes"></a>
</h3>
<p>There are three required top-level HDF5 attributes: “project”,
“active.assay”, and “version”. Each of these must be a single
<a href="#character-representation">character</a>. The “project” attribute
corresponds to the project value of a <code>Seurat</code> object; the
“active.assay” attribute is the name of the default assay and must be
present in the <a href="#assay-expression-data">“assays” group</a>. The
“version” corresponds to the version of Seurat that the h5Seurat file is
based on.</p>
</div>
<div class="section level3">
<h3 id="top-level-datasets-and-groups">Top-Level Datasets and Groups<a class="anchor" aria-label="anchor" href="#top-level-datasets-and-groups"></a>
</h3>
<p>There are two required top-level HDF5 datasets: “cell.names” and
“meta.data”. The “cell.names” dataset should be a one-dimensional
<a href="#character-representation">character</a> dataset, with a length
equal to the number of cells present in the data. Cell names are not
stored anywhere else in the h5Seurat file.</p>
<p>The “meta.data” dataset contains cell-level metadata. It should be
stored as either an <a href="#data-frame-representation">HDF5 dataset or
group</a>, depending on the contents of the meta data. See the
<a href="#data-frame-representation">data frame representation</a> for
more details.</p>
</div>
</div>
<div class="section level2">
<h2 id="assay-expression-data">Assay Expression Data<a class="anchor" aria-label="anchor" href="#assay-expression-data"></a>
</h2>
<p><a href="https://rdrr.io/cran/SeuratObject/man/Assay-class.html" class="external-link"><code>Assay</code></a>
objects are stored in the top-level group “assays”; each assay is stored
as its own group within the “assays” group. Within each assay group,
there must be a dataset named “features” and either a dataset or group
named “data”; the “features” dataset must be a one-dimensional
<a href="#character-representation">character</a> dataset with a length
equal to the number of total features within the assay. The “data” entry
is a matrix, with dimensions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>f</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>s</mi></mrow></msub><mi>x</mi><msub><mi>n</mi><mrow><mi>c</mi><mi>e</mi><mi>l</mi><mi>l</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{features} x n_{cells}</annotation></semantics></math>;
this entry may be either a dataset, if “data” is a
<a href="#dense-matrix-representation">dense matrix</a>, or a group, if
“data” is a <a href="#sparse-matrix-representation">sparse matrix</a>.
Assay groups must also have an attribute named “key”; this is a single
<a href="#character-representation">character</a> value.</p>
<p>Assay groups may also have the following optional groups and
datasets:</p>
<ul>
<li>“counts”: either a <a href="#dense-matrix-representation">dense</a> or
<a href="#sparse-matrix-representation">sparse</a> matrix; must have the
same dimesions as “data”</li>
<li>“scale.data”: a <a href="#dense-matrix-representation">dense</a>
matrix; if “scale.data” is present, a one-dimensional
<a href="#character-representation">character</a> dataset must also be
present. The “scale.data” matrix must be of dimensions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>d</mi><mi>f</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>s</mi></mrow></msub><mi>x</mi><msub><mi>n</mi><mrow><mi>c</mi><mi>e</mi><mi>l</mi><mi>l</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{scaled features} x n_{cells}</annotation></semantics></math>
</li>
<li>“meta.features”: a <a href="#data-frame-representation">data frame</a>
with the same number of rows as values present in “features”</li>
<li>“variable.features”: a one-dimensional
<a href="#character-representation">character</a> dataset</li>
<li>“misc”: a
<a href="#list-and-custom-class-representation">list</a>
</li>
</ul>
<p>Subclasses of
<a href="https://rdrr.io/cran/SeuratObject/man/Assay-class.html" class="external-link"><code>Assay</code></a>
objects must also follow the same rules as
<a href="#list-and-custom-class-representation">custom S4 classes</a>.</p>
<p><strong>Seurat V5 Assay5 Support</strong>: This implementation fully
supports Seurat v5 <code>Assay5</code> objects. When saving to h5Seurat,
<code>Assay5</code> objects are automatically converted to the storage
format described above, with layers (counts, data, scale.data) preserved
as separate matrices. When loading, the format is compatible with both
legacy <code>Assay</code> and modern <code>Assay5</code> objects.</p>
</div>
<div class="section level2">
<h2 id="dimensional-reductions">Dimensional Reductions<a class="anchor" aria-label="anchor" href="#dimensional-reductions"></a>
</h2>
<p><a href="https://rdrr.io/cran/SeuratObject/man/DimReduc-class.html" class="external-link">Dimensional
reduction information</a> is stored in the top-level group “reductions”;
each dimensional reduction is stored as its own group within the
“reductions” group. Within each dimensional reduction group, there are
three required attributes: “active.assay”, “key”, and “global”;
“active.assay” must be one or more
<a href="#character-representation">character</a> values where each value
is a name of an <a href="#assay-expression-data">assay</a>, “key” must
be a single a <a href="#character-representation">character</a> value, and
“global” must be a single <a href="#logical-representation">logical</a>
value. In addition, there must also be a dataset named “cell.embeddings”
representing a <a href="#dense-matrix-representation">dense matrix</a>.
This matrix must have the same number of rows as cells present in the
h5Seurat file.</p>
<p>Dimensional reduction groups may also have the following optional
groups and datasets:</p>
<ul>
<li>“feature.loadings”: …</li>
<li>“feature.loadings.projected”: …</li>
<li>“misc”: a
<a href="#list-and-custom-class-representation">list</a>
</li>
<li>“jackstraw”: a <a href="#list-and-custom-class-representation">custom
S4 group</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="nearest-neighbor-graphs">Nearest-Neighbor Graphs<a class="anchor" aria-label="anchor" href="#nearest-neighbor-graphs"></a>
</h2>
<p><a href="https://rdrr.io/cran/SeuratObject/man/Graph-class.html" class="external-link">Nearest-neighbor
graphs</a> are stored in the top-level group “graphs”; each graph is
stored as its own group within the “graphs” group. Graph names become
graph group names. Graphs are stored as
<a href="#sparse-matrix-representation">sparse matrices</a> with an
additional HDF5 attribute: “assay.used”. This HDF5 attribute should be a
single <a href="#character-representation">character</a> value.</p>
</div>
<div class="section level2">
<h2 id="spatial-image-data">Spatial Image Data<a class="anchor" aria-label="anchor" href="#spatial-image-data"></a>
</h2>
<p>Spatial image data is stored in the top-level group “images”; each
image is stored as its own group within the “images” group. Actual
structure of the image group is dependent on the structure of the
spatial image data. However, it follows the same rules as
<a href="#list-and-custom-class-representation">custom S4 classes</a>.</p>
<p><strong>Note</strong>: spatial images are only supported in objects
that were generated by a version of Seurat that has spatial support.
Currently, this is restricted to version 3.1.5.9900 or higher.</p>
<!-- ## Cell-Level Metadata -->
</div>
<div class="section level2">
<h2 id="command-logs">Command Logs<a class="anchor" aria-label="anchor" href="#command-logs"></a>
</h2>
</div>
<div class="section level2">
<h2 id="miscellaneous-information-and-tool-specific-results">Miscellaneous Information and Tool-Specific Results<a class="anchor" aria-label="anchor" href="#miscellaneous-information-and-tool-specific-results"></a>
</h2>
<p>Miscellaneous information is stored in the top-level group “misc”;
this group follows the same runs as
<a href="#list-and-custom-class-representation">lists</a>. The “misc”
group is required to be present, but not required to be filled.</p>
<p>Tool-specific results are stored in the top-level group “tools”; this
group follows the same runs as
<a href="#list-and-custom-class-representation">lists</a>. The “tools”
group is required to be present, but not required to be filled.</p>
</div>
<div class="section level2">
<h2 id="common-data-structures">Common Data Structures<a class="anchor" aria-label="anchor" href="#common-data-structures"></a>
</h2>
<p>Some data types are found commonly throughout <code>Seurat</code>
objects</p>
<div class="section level3">
<h3 id="character-representation">Character Representation<a class="anchor" aria-label="anchor" href="#character-representation"></a>
</h3>
<p>All
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/character.html" class="external-link">character</a>
values (strings in other languages) should be encoding as
variable-length UTF-8 strings; this applies to HDF5 datasets (including
standalone
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_STRING-class.html" class="external-link">string</a>
datasets as well as parts of
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_COMPOUND-class.html" class="external-link">compound</a>
datasets) and HDF5 attributes.</p>
</div>
<div class="section level3">
<h3 id="dense-matrix-representation">Dense Matrix Representation<a class="anchor" aria-label="anchor" href="#dense-matrix-representation"></a>
</h3>
<p>Dense matrices should be stored as a two-dimensional dataset of any
type. Datasets should be written in a <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order" class="external-link">column-major</a>
order. For column-major implementations (eg. R, Fortran), dataset
dimensions on-disk should be the same as dimensions in-memory (eg.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>k</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow></msub><mi>x</mi><msub><mi>n</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>k</mi><mi>c</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>∼</mo><msub><mi>m</mi><mrow><mi>m</mi><mi>e</mi><mi>m</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow></msub><mi>x</mi><msub><mi>n</mi><mrow><mi>m</mi><mi>e</mi><mi>m</mi><mi>c</mi><mi>o</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{diskrow} x n_{diskcol} \sim m_{memrow} x n_{memcol}</annotation></semantics></math>).
For row-major implmentations (eg. C/C++, Python), dataset dimensions
on-disk should appear <em>transposed</em> to dimensions in-memory (eg.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>k</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow></msub><mi>x</mi><msub><mi>n</mi><mrow><mi>d</mi><mi>i</mi><mi>s</mi><mi>k</mi><mi>c</mi><mi>o</mi><mi>l</mi></mrow></msub><mo>∼</mo><msub><mi>n</mi><mrow><mi>m</mi><mi>e</mi><mi>m</mi><mi>r</mi><mi>o</mi><mi>w</mi></mrow></msub><mi>x</mi><msub><mi>m</mi><mrow><mi>m</mi><mi>e</mi><mi>m</mi><mi>c</mi><mi>o</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{diskrow} x n_{diskcol} \sim n_{memrow} x m_{memcol}</annotation></semantics></math>);
row-major implmemetnations transpose datasets prior to reading and
writing data.</p>
<pre><code><span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0    0    0    1</span></span>
<span><span class="co">#&gt; [2,]    0    1    1    1</span></span>
<span><span class="co">#&gt; [3,]    1    1    0    0</span></span>
<span><span class="co">#&gt; HDF5 Dataset: densemat</span></span>
<span><span class="co">#&gt;   Dimensions: 3 x 4</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0    0    0    1</span></span>
<span><span class="co">#&gt; [2,]    0    1    1    1</span></span>
<span><span class="co">#&gt; [3,]    1    1    0    0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sparse-matrix-representation">Sparse Matrix Representation<a class="anchor" aria-label="anchor" href="#sparse-matrix-representation"></a>
</h3>
<p>Sparse matrices are stored as an HDF5 group with three datasets:
“indices”, “indptr”, and “data”; the “indices” and “data” datasets must
be the same length. “data” represents each non-zero element of the
matrix. “indices” represents the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>-based
row numbers for each value in “data”</p>
<pre><code><span><span class="co">#&gt; 3 x 4 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; [1,] . . . 1</span></span>
<span><span class="co">#&gt; [2,] . 1 1 1</span></span>
<span><span class="co">#&gt; [3,] 1 1 . .</span></span>
<span><span class="co">#&gt; HDF5 Group: sparsemat</span></span>
<span><span class="co">#&gt;   Members: data, indices, indptr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HDF5 Dataset: sparsemat/indices</span></span>
<span><span class="co">#&gt;   Length: 6</span></span>
<span><span class="co">#&gt; [1] 2 1 2 1 0 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HDF5 Dataset: sparsemat/data</span></span>
<span><span class="co">#&gt;   Length: 6</span></span>
<span><span class="co">#&gt; [1] 1 1 1 1 1 1</span></span></code></pre>
<p>“indptr” represents the points in “data” at which a new column is
started. This dataset is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>-based
and should be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mrow><mi>c</mi><mi>o</mi><mi>l</mi><mi>u</mi><mi>m</mi><mi>n</mi><mi>s</mi></mrow></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n_{columns} + 1</annotation></semantics></math>
in length.</p>
<pre><code><span><span class="co">#&gt; HDF5 Dataset: sparsemat/indptr</span></span>
<span><span class="co">#&gt;   Length: 5</span></span>
<span><span class="co">#&gt; [1] 0 1 3 4 6</span></span></code></pre>
<p>The “indices”, “indptr”, and “data” datasets correspond to the “i”,
“p”, and “x” slots in a
<a href="https://rdrr.io/cran/Matrix/man/dgCMatrix-class.html" class="external-link"><code>dgCMatrix</code></a>,
respectively.</p>
<p>There may optionally be an HDF5 attribute called “dims”; this
attribute should be a two
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_INTEGER-class.html" class="external-link">integer</a>
values corresponding to the number of rows and number of columns, in
that order, in the sparse matrix.</p>
<pre><code><span><span class="co">#&gt; [1] 3 4</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="factor-representation">Factor Representation<a class="anchor" aria-label="anchor" href="#factor-representation"></a>
</h3>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/factor.html" class="external-link">Factors</a>
should be stored as an HDF5 group with two datasets: “levels” and
“values”</p>
<pre><code><span><span class="co">#&gt; [1] g1 g2 g1 g1 g2</span></span>
<span><span class="co">#&gt; Levels: g1 g2</span></span>
<span><span class="co">#&gt; HDF5 Group: factor</span></span>
<span><span class="co">#&gt;   Members: levels, values</span></span></code></pre>
<p>The “levels” dataset should be a
<a href="#character-representation">character</a> dataset with one entry
per
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/levels.html" class="external-link">level</a></p>
<pre><code><span><span class="co">#&gt; HDF5 Dataset: factor/levels</span></span>
<span><span class="co">#&gt;   Length: 2</span></span>
<span><span class="co">#&gt; [1] "g1" "g2"</span></span></code></pre>
<p>The “values” dataset should be an integer dataset with one entry per
value in the original factor. These integers should correspond to the
factor level they had in R</p>
<pre><code><span><span class="co">#&gt; HDF5 Dataset: factor/values</span></span>
<span><span class="co">#&gt;   Length: 5</span></span>
<span><span class="co">#&gt; [1] 1 2 1 1 2</span></span></code></pre>
<p>The number of unique entries in “values” should not exceed the number
of unique entries in “levels”</p>
<details><summary>
Rationale
</summary>
Storing factors in this manner seems excessive from an R perspective.
HDF5 has the concept of
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_ENUM-class.html" class="external-link">enumerated
datasets (enums)</a> which are an efficient way to store R factors
on-disk. However, <a href="http://docs.h5py.org/en/stable/special.html#enumerated-types" class="external-link">some
implementations of HDF5 do not support enums</a> and thus lose factor
level information. In order to make h5Seurat as cross-language as
possible, we have opted to store factors as HDF5 groups instead of HDF5
enums.
</details>
</div>
<div class="section level3">
<h3 id="logical-representation">Logical Representation<a class="anchor" aria-label="anchor" href="#logical-representation"></a>
</h3>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/logical.html" class="external-link">Logical</a>
values (booleans in other languages) are encoded as integers in the
following manner: <code>FALSE</code> is encoded as <code>0</code>,
<code>TRUE</code> is encoded as <code>1</code>, and <code>NA</code> is
encoded as <code>2</code></p>
<pre><code><span><span class="co">#&gt; [1]  TRUE FALSE    NA</span></span>
<span><span class="co">#&gt; HDF5 Dataset: logicals</span></span>
<span><span class="co">#&gt;   Length: 3</span></span>
<span><span class="co">#&gt; [1] 1 0 2</span></span></code></pre>
<p>An optional HDF5 attribute named “s3class” with the value “logical”
is allowed to enforce reading in the dataset as logical values. This
HDF5 attribute is a single
<a href="#character-representation">character</a> value.</p>
<details><summary>
Rationale
</summary><p>Unlike most languages,
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/logical.html" class="external-link">logicals</a>
(or booleans) can take one of <em>three</em> values: <code>TRUE</code>,
<code>FALSE</code>, or <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/NA.html" class="external-link"><code>NA</code></a>;
as such, an extra integer value is needed to handle the additional
logical value. Typically, these values are stored as
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_ENUM-class.html" class="external-link">enums</a>
with mappings between the logical representation and integer value.
However, <a href="http://docs.h5py.org/en/stable/special.html#enumerated-types" class="external-link">some
implementations of HDF5 do not support enums</a> and thus lose the
logical representation. Since the mappings are lost, all logicals are
stored as integers instead.</p>
</details>
</div>
<div class="section level3">
<h3 id="data-frame-representation">Data Frame Representation<a class="anchor" aria-label="anchor" href="#data-frame-representation"></a>
</h3>
<p>There are two ways of storing
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/data.frame.html" class="external-link">data
frames</a> in h5Seurat files: as
<a href="#data-frame-datasets">datasets</a> or as
<a href="#data-frame-groups">groups</a>. Data frame groups are required
when data frames contain
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/factor.html" class="external-link">factors</a>;
if no factors are present, data frames can be stored in either type.</p>
<details><summary>
Rationale
</summary><a href="#factor-representation">Storing factors</a> on-disk in an HDF5
file poses a unique set of challenges. Namely,
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_ENUM-class.html" class="external-link">enumerated
datasets (enums)</a>, which are an ideal method of storing mapping
values, <a href="http://docs.h5py.org/en/stable/special.html#enumerated-types" class="external-link">are
not supported in some implementations of HDF5</a>. As factor level
information is lost under implementations that do not support HDF5
enums, we need a method of storing factors in a cross-language manner.
Two options were presented: groups or
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_COMPOUND-class.html" class="external-link">compound
datasets</a>. While the former seems excessive, the latter presents
issues with unequal dataset length. Therefore, to accomodate factor
level information in data frames, we utilize HDF5 groups to store data
frames when one or more columns are
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/factor.html" class="external-link">factors</a>.
</details><div class="section level4">
<h4 id="data-frame-datasets">Data Frame Datasets<a class="anchor" aria-label="anchor" href="#data-frame-datasets"></a>
</h4>
<p>Data frames stored as datasets should be a one-dimensional
<a href="https://hhoeflin.github.io/hdf5r/reference/H5T_COMPOUND-class.html" class="external-link">compound
dataset</a>. The single dimension should be equal to the number of
observations (number of rows) in the data frame. Each data type in the
compound dataset must adhere to the same requirements as standard
datasets (eg. <a href="#character-representation">character encodings</a>,
<a href="#logical-representation">logical mapping</a>, etc). The compound
labels should correspond to the data frame column names.</p>
<pre><code><span><span class="co">#&gt;    x y</span></span>
<span><span class="co">#&gt; 1 g1 1</span></span>
<span><span class="co">#&gt; 2 g1 2</span></span>
<span><span class="co">#&gt; 3 g2 3</span></span>
<span><span class="co">#&gt; 4 g1 4</span></span>
<span><span class="co">#&gt; 5 g2 5</span></span>
<span><span class="co">#&gt; HDF5 Dataset: dfdataset (compound)</span></span>
<span><span class="co">#&gt;   Length: 5</span></span>
<span><span class="co">#&gt;    x y</span></span>
<span><span class="co">#&gt; 1 g1 1</span></span>
<span><span class="co">#&gt; 2 g1 2</span></span>
<span><span class="co">#&gt; 3 g2 3</span></span>
<span><span class="co">#&gt; 4 g1 4</span></span>
<span><span class="co">#&gt; 5 g2 5</span></span></code></pre>
<p>Row names are not stored with the dataset itself, but may be stored
elsewhere in the h5Seurat file, typically named
<code>dataset_name.row.names</code>; an optional HDF5 attribute called
“logicals” containing the names of
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/logical.html" class="external-link">logical</a>
columns is allowed. This attribute consists of
<a href="#character-representation">character values</a>.</p>
</div>
<div class="section level4">
<h4 id="data-frame-groups">Data Frame Groups<a class="anchor" aria-label="anchor" href="#data-frame-groups"></a>
</h4>
<p>Data frames stored as groups are used when
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/factor.html" class="external-link">factors</a>
are present in the data frame. Within the data frame group, there should
be one dataset or group per column. Columns that are factors are
<a href="#factor-representation">stored as groups</a> while all other
columns are stored as one-dimensional datasets. Each dataset within the
group must adhere to the same requirements as standard datasets (eg.
<a href="#character-representation">character encodings</a>,
<a href="#logical-representation">logical mapping</a>, etc). The names of
the datasets within the group correspond to the data frame column
names</p>
<pre><code><span><span class="co">#&gt; HDF5 Group: dfgroup</span></span>
<span><span class="co">#&gt;   Members: _index, x, y</span></span></code></pre>
<p>Data frame row names may be stored in a dataset called “row.names”
within the group; this dataset should be a one-dimensional
<a href="#character-representation">character</a> dataset. There are two
optional attributes allowed: “colnames” and “logicals”; the “colnames”
attribute contains the column names in the same order as was present in
the in-memory
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/data.frame.html" class="external-link">data
frame</a> as <a href="#character-representation">character values</a>.
This is used to control column order when reading the data frame back
into memory. Note, the “colnames” attribute does not need to contain the
name of every dataset.</p>
<p>The “logicals” attribute contains the names of
<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/logical.html" class="external-link">logical</a>
columns; this attribute should consist of
<a href="#character-representation">character values</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="list-and-custom-class-representation">List and Custom Class Representation<a class="anchor" aria-label="anchor" href="#list-and-custom-class-representation"></a>
</h3>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/list.html" class="external-link">Lists</a>
are stored as HDF5 groups. Each entry in a list must be named; the names
serve as the names of datasets and groups within the list group. List
values are stored as HDF5 datasets or groups, depending on their R
object type. For example, a list within a list would be stored as a
group within the first group.</p>
<pre><code><span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b</span></span>
<span><span class="co">#&gt; $b$b1</span></span>
<span><span class="co">#&gt; [1] "hello"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $b$b2</span></span>
<span><span class="co">#&gt; [1] "tomato" "potato"</span></span>
<span><span class="co">#&gt; HDF5 Group: list</span></span>
<span><span class="co">#&gt;   Members: a, b</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HDF5 Group: list/b</span></span>
<span><span class="co">#&gt;   Members: b1, b2</span></span></code></pre>
<p>Custom classes are stored as
<a href="#list-and-custom-class-representation">lists</a> with a special
HDF5 attribute. S3 classes are stored with the attribute “s3class”,
which has a value equal to the class of the object. This attribute is a
variable-length <a href="#character-representation">character</a>
value.</p>
<p>Custom S4 classes are also stored as
<a href="#list-and-custom-class-representation">lists</a> where each entry
is a slot in the S4 class. S4 class groups have an attribute named
“s4class”; this attribute should be a single-length
<a href="#character-representation">character</a> storing the name of the
class and the package that defines the class in the form of
<code>package:class</code> (eg. <code>Signac:ChromatinAssay</code>);
custom S4 classes defined in the <a href="https://satijalab.org/seurat" class="external-link">Seurat</a> package can be named with
just the class of the object.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miana Z, Paul Hoffman, Rahul Satija.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
