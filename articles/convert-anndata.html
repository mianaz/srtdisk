<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Conversions: h5Seurat and AnnData • srtdisk</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conversions: h5Seurat and AnnData">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">srtdisk</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/convert-anndata.html">Conversions: h5Seurat and AnnData</a></li>
    <li><a class="dropdown-item" href="../articles/h5Seurat-load.html">Saving and Loading Data from an h5Seurat File</a></li>
    <li><a class="dropdown-item" href="../articles/h5Seurat-spec.html">h5Seurat File Format Specification</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mianaz/srtdisk/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Conversions: h5Seurat and AnnData</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mianaz/srtdisk/blob/HEAD/vignettes/convert-anndata.Rmd" class="external-link"><code>vignettes/convert-anndata.Rmd</code></a></small>
      <div class="d-none name"><code>convert-anndata.Rmd</code></div>
    </div>

    
    
<p>This vignette showcases how to convert between <code>Seurat</code>
objects and AnnData files via h5Seurat files. This allows
interoperability between Seurat and <a href="https://scanpy.readthedocs.io/" class="external-link">Scanpy</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mianaz.github.io/srtdisk/">srtdisk</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="converting-from-seurat-to-anndata-via-h5seurat">Converting from Seurat to AnnData via h5Seurat<a class="anchor" aria-label="anchor" href="#converting-from-seurat-to-anndata-via-h5seurat"></a>
</h2>
<p>To demonstrate conversion from a <code>Seurat</code> object to an
AnnData file, we’ll use the <code>pbmc3k.final</code> dataset from
SeuratData - a processed PBMC dataset with clustering and UMAP.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.satijalab.org/seurat" class="external-link">SeuratData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install pbmc3k if not already installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"pbmc3k.final"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/InstalledData.html" class="external-link">InstalledData</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/InstallData.html" class="external-link">InstallData</a></span><span class="op">(</span><span class="st">"pbmc3k"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Load the processed pbmc3k dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pbmc3k.final"</span>, package <span class="op">=</span> <span class="st">"pbmc3k.SeuratData"</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/UpdateSeuratObject.html" class="external-link">UpdateSeuratObject</a></span><span class="op">(</span><span class="va">pbmc3k.final</span><span class="op">)</span></span>
<span><span class="va">pbmc</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 13714 features across 2638 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (13714 features, 2000 variable features)</span></span>
<span><span class="co">#&gt;  3 layers present: counts, data, scale.data</span></span>
<span><span class="co">#&gt;  2 dimensional reductions calculated: pca, umap</span></span></code></pre></div>
<p>This is a fully processed Seurat object with clustering and
dimensional reductions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"umap"</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, pt.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html" class="external-link">NoLegend</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="convert-anndata_files/figure-html/plot_pbmc-1.png" class="r-plt" alt="" width="100%"></p>
<p>Converting the <code>Seurat</code> object to an AnnData file is a
two-step process:</p>
<ol style="list-style-type: decimal">
<li>Save the <code>Seurat</code> object as an h5Seurat file using
<code><a href="../reference/SaveH5Seurat.html">SaveH5Seurat()</a></code>
</li>
<li>Convert to AnnData using <code><a href="../reference/Convert.html">Convert()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SaveH5Seurat.html">SaveH5Seurat</a></span><span class="op">(</span><span class="va">pbmc</span>, filename <span class="op">=</span> <span class="st">"pbmc3k.h5Seurat"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Convert.html">Convert</a></span><span class="op">(</span><span class="st">"pbmc3k.h5Seurat"</span>, dest <span class="op">=</span> <span class="st">"h5ad"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can view the AnnData file in Scanpy:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>adata <span class="op">=</span> sc.read_h5ad(<span class="st">"pbmc3k.h5ad"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="bu">print</span>(adata)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; AnnData object with n_obs × n_vars = 2638 × 13714</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;     obs: 'orig.ident', 'nCount_RNA', 'nFeature_RNA', 'seurat_annotations', 'percent.mt', 'RNA_snn_res.0.5', 'seurat_clusters'</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;     var: 'vst.mean', 'vst.variance', 'vst.variance.expected', 'vst.variance.standardized', 'vst.variable'</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;     uns: 'n_variable_features', 'neighbors', 'seurat'</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;     obsm: 'X_pca', 'X_umap'</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt;     varm: 'PCs'</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;     obsp: 'connectivities', 'distances'</span></span></code></pre></div>
<p>And visualize with cluster annotations:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>matplotlib.use(<span class="st">'Agg'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>sc.pl.umap(adata, color<span class="op">=</span><span class="st">'seurat_annotations'</span>, legend_loc<span class="op">=</span><span class="st">'on data'</span>, legend_fontsize<span class="op">=</span><span class="dv">8</span>, show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>plt.savefig(<span class="st">'umap_plot.png'</span>, dpi<span class="op">=</span><span class="dv">100</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p><img src="umap_plot.png" class="r-plt" alt="" width="80%"></p>
</div>
<div class="section level2">
<h2 id="converting-from-anndata-to-seurat-via-h5seurat">Converting from AnnData to Seurat via h5Seurat<a class="anchor" aria-label="anchor" href="#converting-from-anndata-to-seurat-via-h5seurat"></a>
</h2>
<p>To demonstrate conversion from AnnData to Seurat, we’ll use a
colorectal cancer sample from <a href="https://cellxgene.cziscience.com" class="external-link">CellxGene</a> that’s bundled
with the package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Copy bundled CRC h5ad file to working directory</span></span>
<span><span class="va">h5ad_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>, <span class="st">"crc_sample.h5ad"</span>, package <span class="op">=</span> <span class="st">"srtdisk"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">h5ad_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">h5ad_path</span>, <span class="st">"crc_sample.h5ad"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Download if not bundled (for development)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>    <span class="st">"https://datasets.cellxgene.cziscience.com/91cf9a95-0b9a-4ece-b8eb-7b9e3409a0d3.h5ad"</span>,</span>
<span>    <span class="st">"crc_sample.h5ad"</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"wb"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>View the h5ad file in Scanpy:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>adata_crc <span class="op">=</span> sc.read_h5ad(<span class="st">"crc_sample.h5ad"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="bu">print</span>(adata_crc)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; AnnData object with n_obs × n_vars = 935 × 25344</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;     obs: 'total_counts', 'log1p_total_counts', 'Sample ID', 'PhenoGraph_clusters', 'Patient', 'Primary Site', 'Sample Type', 'Site', 'DC 1', 'DC 2', 'DC 3', 'DC 4', 'Module Absorptive Intestine Score', 'Module EMT Score', 'Module Injury Repair Score', 'Module Squamous Score', 'Module Neuroendocrine Score', 'Module Endoderm Development Score', 'Module Tumor ISC-like Score', 'Module Secretory Intestine Score', 'Module Intestine Score', 'palantir_pseudotime', 'palantir_neuroendocrine_branch_probability', 'palantir_squamous_branch_probability', 'Fetal, Conserved', 'Module Osteoblast Score', 'Treatment', 'donor_id', 'development_stage_ontology_term_id', 'sex_ontology_term_id', 'self_reported_ethnicity_ontology_term_id', 'disease_ontology_term_id', 'tissue_type', 'tissue_ontology_term_id', 'cell_type_ontology_term_id', 'assay_ontology_term_id', 'suspension_type', 'Tumor Status', 'is_primary_data', 'cell_type', 'assay', 'disease', 'sex', 'tissue', 'self_reported_ethnicity', 'development_stage', 'observation_joinid'</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;     var: 'total_counts', 'highly_variable', 'gene', 'feature_is_filtered', 'feature_name', 'feature_reference', 'feature_biotype', 'feature_length', 'feature_type'</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;     uns: 'citation', 'default_embedding', 'neighbors', 'organism', 'organism_ontology_term_id', 'schema_reference', 'schema_version', 'title'</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;     obsm: 'X_umap'</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">obs columns:"</span>, <span class="bu">list</span>(adata_crc.obs.columns)[:<span class="dv">10</span>])</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; obs columns: ['total_counts', 'log1p_total_counts', 'Sample ID', 'PhenoGraph_clusters', 'Patient', 'Primary Site', 'Sample Type', 'Site', 'DC 1', 'DC 2']</span></span></code></pre></div>
<p>Convert to Seurat:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Convert.html">Convert</a></span><span class="op">(</span><span class="st">"crc_sample.h5ad"</span>, dest <span class="op">=</span> <span class="st">"h5seurat"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">crc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/LoadH5Seurat.html">LoadH5Seurat</a></span><span class="op">(</span><span class="st">"crc_sample.h5seurat"</span><span class="op">)</span></span>
<span><span class="va">crc</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 25344 features across 935 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (25344 features, 0 variable features)</span></span>
<span><span class="co">#&gt;  1 layer present: counts</span></span>
<span><span class="co">#&gt;  1 dimensional reduction calculated: umap</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot UMAP if available</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"umap"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/ObjectAccess.html" class="external-link">Reductions</a></span><span class="op">(</span><span class="va">crc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">crc</span>, reduction <span class="op">=</span> <span class="st">"umap"</span>, pt.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="convert-anndata_files/figure-html/plot_crc-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level2">
<h2 id="visium-spatial-data-conversion">Visium Spatial Data Conversion<a class="anchor" aria-label="anchor" href="#visium-spatial-data-conversion"></a>
</h2>
<p>For spatial transcriptomics data, we use the stxBrain dataset from
SeuratData (Visium v2 format):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.satijalab.org/seurat" class="external-link">SeuratData</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install stxBrain if not already installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"stxBrain"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/InstalledData.html" class="external-link">InstalledData</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/InstallData.html" class="external-link">InstallData</a></span><span class="op">(</span><span class="st">"stxBrain"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Load anterior1 section</span></span>
<span><span class="va">brain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/UpdateSeuratObject.html" class="external-link">UpdateSeuratObject</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/LoadData.html" class="external-link">LoadData</a></span><span class="op">(</span><span class="st">"stxBrain"</span>, type <span class="op">=</span> <span class="st">"anterior1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">brain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">brain</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialFeaturePlot</a></span><span class="op">(</span><span class="va">brain</span>, features <span class="op">=</span> <span class="st">"Hpca"</span><span class="op">)</span></span></code></pre></div>
<p><img src="convert-anndata_files/figure-html/get_stxBrain-1.png" class="r-plt" alt="" width="100%"></p>
<p>Convert to h5ad:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SaveH5Seurat.html">SaveH5Seurat</a></span><span class="op">(</span><span class="va">brain</span>, filename <span class="op">=</span> <span class="st">"stxBrain.h5Seurat"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Convert.html">Convert</a></span><span class="op">(</span><span class="st">"stxBrain.h5Seurat"</span>, dest <span class="op">=</span> <span class="st">"h5ad"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>View in Python with Squidpy:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="im">import</span> squidpy <span class="im">as</span> sq</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>matplotlib.use(<span class="st">'Agg'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>adata_spatial <span class="op">=</span> sc.read_h5ad(<span class="st">"stxBrain.h5ad"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>sq.pl.spatial_scatter(</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    adata_spatial,</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"Hpca"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    library_id<span class="op">=</span><span class="st">"anterior1"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    img_res_key<span class="op">=</span><span class="st">"lowres"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    size<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>    ax<span class="op">=</span>ax</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>)</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>plt.savefig(<span class="st">'stxBrain_plot.png'</span>, dpi<span class="op">=</span><span class="dv">100</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p><img src="stxBrain_plot.png" class="r-plt" alt="" width="80%"></p>
</div>
<div class="section level2">
<h2 id="python-environment-setup">Python Environment Setup<a class="anchor" aria-label="anchor" href="#python-environment-setup"></a>
</h2>
<p>For optimal interoperability, we recommend using a conda environment
with scanpy:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use existing scverse environment</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span><span class="st">"scverse"</span>, required <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or create a new environment</span></span>
<span><span class="co"># reticulate::conda_create("scverse")</span></span>
<span><span class="co"># reticulate::conda_install("scverse", c("scanpy", "squidpy", "anndata"))</span></span>
<span></span>
<span><span class="co"># Verify configuration</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_config.html" class="external-link">py_config</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"scanpy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Scanpy version:"</span>, <span class="va">sc</span><span class="op">$</span><span class="va">`__version__`</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scanpy version: 1.11.3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-preservation">Metadata Preservation<a class="anchor" aria-label="anchor" href="#metadata-preservation"></a>
</h2>
<p>srtdisk preserves cell metadata during conversion:</p>
<ul>
<li>
<strong>Categorical data</strong>: Cell types, clusters, batch
labels</li>
<li>
<strong>Numerical data</strong>: QC metrics like nCount_RNA,
percent.mt</li>
<li>
<strong>Factor ordering</strong>: Level order for visualization</li>
</ul>
<div class="section level3">
<h3 id="cluster-column-mapping">Cluster Column Mapping<a class="anchor" aria-label="anchor" href="#cluster-column-mapping"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Seurat</th>
<th>AnnData/scanpy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>seurat_clusters</code></td>
<td>
<code>leiden</code> or <code>louvain</code>
</td>
</tr>
<tr class="even">
<td><code>orig.ident</code></td>
<td><code>batch</code></td>
</tr>
<tr class="odd">
<td><code>nCount_RNA</code></td>
<td><code>n_counts</code></td>
</tr>
<tr class="even">
<td><code>nFeature_RNA</code></td>
<td><code>n_genes</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Tahoe 26.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: America/Indiana/Indianapolis</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] stxKidney.SeuratData_0.1.0    stxBrain.SeuratData_0.1.2    </span></span>
<span><span class="co">#&gt;  [3] ssHippo.SeuratData_3.1.4      pbmcref.SeuratData_1.0.0     </span></span>
<span><span class="co">#&gt;  [5] pbmcMultiome.SeuratData_0.1.4 pbmc3k.SeuratData_3.1.4      </span></span>
<span><span class="co">#&gt;  [7] panc8.SeuratData_3.0.2        cbmc.SeuratData_3.1.4        </span></span>
<span><span class="co">#&gt;  [9] SeuratData_0.2.2.9002         srtdisk_0.1.0                </span></span>
<span><span class="co">#&gt; [11] Seurat_5.4.0                  SeuratObject_5.3.0           </span></span>
<span><span class="co">#&gt; [13] sp_2.2-0                      reticulate_1.44.1            </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] RColorBrewer_1.1-3     jsonlite_2.0.0         magrittr_2.0.4        </span></span>
<span><span class="co">#&gt;   [4] spatstat.utils_3.2-1   farver_2.1.2           rmarkdown_2.30        </span></span>
<span><span class="co">#&gt;   [7] fs_1.6.6               ragg_1.5.0             vctrs_0.7.0           </span></span>
<span><span class="co">#&gt;  [10] ROCR_1.0-11            spatstat.explore_3.6-0 htmltools_0.5.9       </span></span>
<span><span class="co">#&gt;  [13] sass_0.4.10            sctransform_0.4.3      parallelly_1.46.1     </span></span>
<span><span class="co">#&gt;  [16] KernSmooth_2.23-26     bslib_0.9.0            htmlwidgets_1.6.4     </span></span>
<span><span class="co">#&gt;  [19] desc_1.4.3             ica_1.0-3              plyr_1.8.9            </span></span>
<span><span class="co">#&gt;  [22] plotly_4.11.0          zoo_1.8-15             cachem_1.1.0          </span></span>
<span><span class="co">#&gt;  [25] igraph_2.2.1           mime_0.13              lifecycle_1.0.5       </span></span>
<span><span class="co">#&gt;  [28] pkgconfig_2.0.3        Matrix_1.7-4           R6_2.6.1              </span></span>
<span><span class="co">#&gt;  [31] fastmap_1.2.0          fitdistrplus_1.2-4     future_1.69.0         </span></span>
<span><span class="co">#&gt;  [34] shiny_1.12.1           digest_0.6.39          patchwork_1.3.2       </span></span>
<span><span class="co">#&gt;  [37] tensor_1.5.1           RSpectra_0.16-2        irlba_2.3.5.1         </span></span>
<span><span class="co">#&gt;  [40] textshaping_1.0.4      labeling_0.4.3         progressr_0.18.0      </span></span>
<span><span class="co">#&gt;  [43] spatstat.sparse_3.1-0  httr_1.4.7             polyclip_1.10-7       </span></span>
<span><span class="co">#&gt;  [46] abind_1.4-8            compiler_4.5.2         bit64_4.6.0-1         </span></span>
<span><span class="co">#&gt;  [49] withr_3.0.2            S7_0.2.1               fastDummies_1.7.5     </span></span>
<span><span class="co">#&gt;  [52] MASS_7.3-65            rappdirs_0.3.4         tools_4.5.2           </span></span>
<span><span class="co">#&gt;  [55] lmtest_0.9-40          otel_0.2.0             httpuv_1.6.16         </span></span>
<span><span class="co">#&gt;  [58] future.apply_1.20.1    goftest_1.2-3          glue_1.8.0            </span></span>
<span><span class="co">#&gt;  [61] nlme_3.1-168           promises_1.5.0         grid_4.5.2            </span></span>
<span><span class="co">#&gt;  [64] Rtsne_0.17             cluster_2.1.8.1        reshape2_1.4.5        </span></span>
<span><span class="co">#&gt;  [67] generics_0.1.4         hdf5r_1.3.12           gtable_0.3.6          </span></span>
<span><span class="co">#&gt;  [70] spatstat.data_3.1-9    tidyr_1.3.2            data.table_1.18.0     </span></span>
<span><span class="co">#&gt;  [73] spatstat.geom_3.7-0    RcppAnnoy_0.0.23       ggrepel_0.9.6         </span></span>
<span><span class="co">#&gt;  [76] RANN_2.6.2             pillar_1.11.1          stringr_1.6.0         </span></span>
<span><span class="co">#&gt;  [79] spam_2.11-3            RcppHNSW_0.6.0         later_1.4.5           </span></span>
<span><span class="co">#&gt;  [82] splines_4.5.2          dplyr_1.1.4            lattice_0.22-7        </span></span>
<span><span class="co">#&gt;  [85] survival_3.8-6         bit_4.6.0              deldir_2.0-4          </span></span>
<span><span class="co">#&gt;  [88] tidyselect_1.2.1       miniUI_0.1.2           pbapply_1.7-4         </span></span>
<span><span class="co">#&gt;  [91] knitr_1.51             gridExtra_2.3          scattermore_1.2       </span></span>
<span><span class="co">#&gt;  [94] xfun_0.56              matrixStats_1.5.0      stringi_1.8.7         </span></span>
<span><span class="co">#&gt;  [97] lazyeval_0.2.2         yaml_2.3.12            evaluate_1.0.5        </span></span>
<span><span class="co">#&gt; [100] codetools_0.2-20       tibble_3.3.1           cli_3.6.5             </span></span>
<span><span class="co">#&gt; [103] uwot_0.2.4             xtable_1.8-4           systemfonts_1.3.1     </span></span>
<span><span class="co">#&gt; [106] jquerylib_0.1.4        dichromat_2.0-0.1      Rcpp_1.1.1            </span></span>
<span><span class="co">#&gt; [109] globals_0.18.0         spatstat.random_3.4-4  png_0.1-8             </span></span>
<span><span class="co">#&gt; [112] spatstat.univar_3.1-6  parallel_4.5.2         pkgdown_2.2.0         </span></span>
<span><span class="co">#&gt; [115] ggplot2_4.0.1          dotCall64_1.2          listenv_0.10.0        </span></span>
<span><span class="co">#&gt; [118] viridisLite_0.4.2      scales_1.4.0           ggridges_0.5.7        </span></span>
<span><span class="co">#&gt; [121] purrr_1.2.1            crayon_1.5.3           rlang_1.1.7           </span></span>
<span><span class="co">#&gt; [124] cowplot_1.2.0</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miana Z, Paul Hoffman, Rahul Satija.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
